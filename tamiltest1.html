
<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tamil Language Practice (Single File - Limited)</title>

  <script src="https://cdn.tailwindcss.com"></script>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: 'Inter', sans-serif;
      -webkit-tap-highlight-color: transparent;
    }
    .tamil-font {
      font-family: 'Inter', 'Lohit Tamil', sans-serif;
    }
    .progress-bar-inner {
      transition: width 0.5s ease-in-out;
    }
    *:focus-visible {
      outline-offset: 2px;
    }
  </style>
  <script type="importmap">
    {
      "imports": {
        "react/": "https://esm.sh/react@^19.1.0/",
        "react": "https://esm.sh/react@^19.1.0",
        "react-dom/": "https://esm.sh/react-dom@^19.1.0/"
      }
    }
  </script>
</head>
<body class="bg-gray-50 dark:bg-slate-900 text-slate-700 dark:text-slate-200 flex items-start justify-center min-h-full p-4">
<div id="root" class="w-full max-w-3xl mx-auto"></div>
<script type="module">
  // --- Start of Inlined Code ---

  const { useState, useCallback, useEffect, Fragment } = React; // Ensure Fragment is destructured

  // From types.ts (Interfaces are conceptual for data structure, not direct JS)
  const View = {
    LessonList: 'lessonList',
    LessonMenu: 'lessonMenu',
    AlphabetView: 'alphabetView',
    GrammarView: 'grammarView',
    VocabularyView: 'vocabularyView',
    ActivityMenu: 'activityMenu',
    MultipleChoice: 'multipleChoice',
    Matching: 'matching',
    SentenceBuilding: 'sentenceBuilding',
    Results: 'results',
    ConjugationMenu: 'conjugationMenu',
    ConjugationPractice: 'conjugationPractice',
  };

  // From constants.ts (Limited Data)
  const LESSONS_DATA = {
    'alphabet': { title: 'The Alphabet', description: 'Learn the Tamil script.', hasGrammar: false },
    1: { title: 'Lesson 1: Animals (மிருகங்கள்)', description: 'Vocabulary related to animals.', hasGrammar: true },
    2: { title: 'Lesson 2: Transportation (போக்குவரத்து)', description: 'Vocabulary related to transportation.', hasGrammar: true },
    'conjugation': { title: 'Verb Conjugations (Reference)', description: 'Reference for verb tenses (Standard Tamil).', hasGrammar: false }
  };

  const ALPHABET_DATA = {
    vowels: [ {tamil: 'அ', trans: 'a'}, {tamil: 'ஆ', trans: 'ā'}, {tamil: 'இ', trans: 'i'}, {tamil: 'ஈ', trans: 'ī'}, {tamil: 'உ', trans: 'u'}, {tamil: 'ஊ', trans: 'ū'}, {tamil: 'எ', trans: 'e'}, {tamil: 'ஏ', trans: 'ē'}, {tamil: 'ஐ', trans: 'ai'}, {tamil: 'ஒ', trans: 'o'}, {tamil: 'ஓ', trans: 'ō'}, {tamil: 'ஔ', trans: 'au'} ],
    consonants: [ {tamil: 'க்', trans: 'k'}, {tamil: 'ங்', trans: 'ṅ'}, {tamil: 'ச்', trans: 'c'}, {tamil: 'ஞ்', trans: 'ñ'}, {tamil: 'ட்', trans: 'ṭ'}, {tamil: 'ண்', trans: 'ṇ'}, {tamil: 'த்', trans: 't'}, {tamil: 'ந்', trans: 'n'}, {tamil: 'ப்', trans: 'p'}, {tamil: 'ம்', trans: 'm'}, {tamil: 'ய்', trans: 'y'}, {tamil: 'ர்', trans: 'r'}, {tamil: 'ல்', trans: 'l'}, {tamil: 'வ்', trans: 'v'}, {tamil: 'ழ்', trans: 'ḻ'}, {tamil: 'ள்', trans: 'ḷ'}, {tamil: 'ற்', trans: 'ṟ'}, {tamil: 'ன்', trans: 'ṉ'} ],
    grantha: [ {tamil: 'ஸ்', trans: 's'}, {tamil: 'ஷ்', trans: 'ṣ'}, {tamil: 'ஜ்', trans: 'j'}, {tamil: 'ஹ்', trans: 'h'}, {tamil: 'க்ஷ்', trans: 'kṣ'} ]
  };

  const GRAMMAR_NOTES_DATA = {
    1: { title: 'Basic Sentence Structure (General Tamil)', points: [ 'The standard word order in Tamil is Subject-Object-Verb (SOV). Example: "நான் தமிழ் படிக்கிறேன்" (I Tamil study).', 'Nouns do not have articles (a, an, the). "புத்தகம்" can mean "book", "a book", or "the book".', 'Pronouns change based on politeness. "நீ" is informal "you", while "நீங்கள்" is formal/plural "you".' ] },
    2: { title: 'Forming Questions (General Tamil)', points: [ 'Yes/No questions are often formed by adding the suffix -ஆ to the end of a word. Example: "இது புத்தகமா?" (Is this a book?).', 'Question words (what, where, when) usually appear where the answer would be in a sentence. Example: "உங்கள் பெயர் என்ன?" (Your name what?).' ] }
  };

  const VOCABULARY_DATA = [
    // Lesson 1: Animals
    { id: 500, lesson: 1, tamil_word: "மிருகங்கள்", english_meaning: "animals" },
    { id: 501, lesson: 1, tamil_word: "நாய்", english_meaning: "a dog" },
    { id: 502, lesson: 1, tamil_word: "பூனை", english_meaning: "a cat" },
    { id: 503, lesson: 1, tamil_word: "மீன்", english_meaning: "a fish" },
    { id: 504, lesson: 1, tamil_word: "பறவை", english_meaning: "a bird" },
    { id: 505, lesson: 1, tamil_word: "மாடு", english_meaning: "a cow" },
    { id: 506, lesson: 1, tamil_word: "பண்டி", english_meaning: "a pig" },
    { id: 507, lesson: 1, tamil_word: "எலி", english_meaning: "a mouse" },
    { id: 508, lesson: 1, tamil_word: "குதிரை", english_meaning: "a horse" },
    { id: 509, lesson: 1, tamil_word: "சிறகு", english_meaning: "a wing" },
    { id: 510, lesson: 1, tamil_word: "மிருகம்", english_meaning: "an animal" },
    // Lesson 2: Transportation
    { id: 511, lesson: 2, tamil_word: "போக்கு வரத்து", english_meaning: "transportation" },
    { id: 512, lesson: 2, tamil_word: "ரயில்", english_meaning: "a train" },
    { id: 513, lesson: 2, tamil_word: "விமானம்", english_meaning: "a plane" },
    { id: 514, lesson: 2, tamil_word: "வாகனம்", english_meaning: "a car" },
    { id: 515, lesson: 2, tamil_word: "லொறி", english_meaning: "a truck" },
    { id: 516, lesson: 2, tamil_word: "சைக்கில்", english_meaning: "a bicycle" },
    { id: 517, lesson: 2, tamil_word: "பஸ்", english_meaning: "a bus" },
    { id: 518, lesson: 2, tamil_word: "படகு", english_meaning: "a small boat" },
    { id: 519, lesson: 2, tamil_word: "கப்பல்", english_meaning: "a ship" },
    { id: 520, lesson: 2, tamil_word: "சில்லு", english_meaning: "a tire" },
    { id: 521, lesson: 2, tamil_word: "பெற்றொல்", english_meaning: "gasoline" },
    { id: 522, lesson: 2, tamil_word: "இயந்திரம்", english_meaning: "an engine" },
    { id: 523, lesson: 2, tamil_word: "ரயில் சீட்டு", english_meaning: "a train ticket" },
    { id: 524, lesson: 2, tamil_word: "சீட்டு", english_meaning: "a ticket" },
  ];

  const SENTENCES_DATA = [
    { lesson: 1, tamil: "அது ஒரு நாய்", english: "That is a dog" },
    { lesson: 1, tamil: "இந்த பூனை சிறியது", english: "This cat is small" },
    { lesson: 2, tamil: "ரயில் எங்கே?", english: "Where is the train?" },
    { lesson: 2, tamil: "இது ஒரு சைக்கில்", english: "This is a bicycle" },
  ];

  const CONJUGATIONS_DATA = {
    'இரு': { english: 'to be, exist', present: { நான்: 'இருக்கிறேன்', நீ: 'இருக்கிறாய்', அவன்: 'இருக்கிறான்', அவள்: 'இருக்கிறாள்', அது: 'இருக்கிறது', நாம்: 'இருக்கிறோம்', நீங்கள்: 'இருக்கிறீர்கள்', அவர்கள்: 'இருக்கிறார்கள்' }, past: { நான்: 'இருந்தேன்', நீ: 'இருந்தாய்', அவன்: 'இருந்தான்', அவள்: 'இருந்தாள்', அது: 'இருந்தது', நாம்: 'இருந்தோம்', நீங்கள்: 'இருந்தீர்கள்', அவர்கள்: 'இருந்தார்கள்' }, future: { நான்: 'இருப்பேன்', நீ: 'இருப்பாய்', அவன்: 'இருப்பான்', அவள்: 'இருப்பாள்', அது: 'இருக்கும்', நாம்: 'இருப்போம்', நீங்கள்: 'இருப்பீர்கள்', அவர்கள்: 'இருப்பார்கள்' } },
    'செய்': { english: 'to do, make', present: { நான்: 'செய்கிறேன்', நீ: 'செய்கிறாய்', அவன்: 'செய்கிறான்', அவள்: 'செய்கிறாள்', அது: 'செய்கிறது', நாம்: 'செய்கிறோம்', நீங்கள்: 'செய்கிறீர்கள்', அவர்கள்: 'செய்கிறார்கள்' }, past: { நான்: 'செய்தேன்', நீ: 'செய்தாய்', அவன்: 'செய்தான்', அவள்: 'செய்தாள்', அது: 'செய்தது', நாம்: 'செய்தோம்', நீங்கள்: 'செய்தீர்கள்', அவர்கள்: 'செய்தார்கள்' }, future: { நான்: 'செய்வேன்', நீ: 'செய்வாய்', அவன்: 'செய்வான்', அவள்: 'செய்வாள்', அது: 'செய்யும்', நாம்: 'செய்வோம்', நீங்கள்: 'செய்வீர்கள்', அவர்கள்: 'செய்வார்கள்' } },
    'பேசு': { english: 'to speak, talk', present: { நான்: 'பேசுகிறேன்', நீ: 'பேசுகிறாய்', அவன்: 'பேசுகிறான்', அவள்: 'பேசுகிறாள்', அது: 'பேசுகிறது', நாம்: 'பேசுகிறோம்', நீங்கள்: 'பேசுகிறீர்கள்', அவர்கள்: 'பேசுகிறார்கள்' }, past: { நான்: 'பேசினேன்', நீ: 'பேசினாய்', அவன்: 'பேசினான்', அவள்: 'பேசினாள்', அது: 'பேசியது', நாம்: 'பேசினோம்', நீங்கள்: 'பேசீர்கள்', அவர்கள்: 'பேசினார்கள்' }, future: { நான்: 'பேசுவேன்', நீ: 'பேசுவாய்', அவன்: 'பேசுவான்', அவள்: 'பேசுவாள்', அது: 'பேசும்', நாம்: 'பேசுவோம்', நீங்கள்: 'பேசுவீர்கள்', அவர்கள்: 'பேசுவார்கள்' } },
    'வா': { english: 'to come', present: { நான்: 'வருகிறேன்', நீ: 'வருகிறாய்', அவன்: 'வருகிறான்', அவள்: 'வருகிறாள்', அது: 'வருகிறது', நாம்: 'வருகிறோம்', நீங்கள்: 'வருகிறீர்கள்', அவர்கள்: 'வருகிறார்கள்' }, past: { நான்: 'வந்தேன்', நீ: 'வந்தாய்', அவன்: 'வந்தான்', அவள்: 'வந்தாள்', அது: 'வந்தது', நாம்: 'வந்தோம்', நீங்கள்: 'வந்தீர்கள்', அவர்கள்: 'வந்தார்கள்' }, future: { நான்: 'வருவேன்', நீ: 'வருவாய்', அவன்: 'வருவான்', அவள்: 'வருவாள்', அது: 'வரும்', நாம்: 'வருவோம்', நீங்கள்: 'வருவீர்கள்', அவர்கள்: 'வருவார்கள்' } },
    'போ': { english: 'to go', present: { நான்: 'போகிறேன்', நீ: 'போகிறாய்', அவன்: 'போகிறான்', அவள்: 'போகிறாள்', அது: 'போகிறது', நாம்: 'போகிறோம்', நீங்கள்: 'போகிறீர்கள்', அவர்கள்: 'போகிறார்கள்' }, past: { நான்: 'போனேன்', நீ: 'போனாய்', அவன்: 'போனான்', அவள்: 'போனாள்', அது: 'போனது', நாம்: 'போனோம்', நீங்கள்: 'போனீர்கள்', அவர்கள்: 'போனார்கள்' }, future: { நான்: 'போவேன்', நீ: 'போவாய்', அவன்: 'போவான்', அவள்: 'போவாள்', அது: 'போகும்', நாம்: 'போவோம்', நீங்கள்: 'போவீர்கள்', அவர்கள்: 'போவார்கள்' } },
    'படி': { english: 'to read, study', present: { நான்: 'படிக்கிறேன்', நீ: 'படிக்கிறாய்', அவன்: 'படிக்கிறான்', அவள்: 'படிக்கிறாள்', அது: 'படிக்கிறது', நாம்: 'படிக்கிறோம்', நீங்கள்: 'படிக்கிறீர்கள்', அவர்கள்: 'படிக்கிறார்கள்' }, past: { நான்: 'படித்தேன்', நீ: 'படித்தாய்', அவன்: 'படித்தான்', அவள்: 'படித்தாள்', அது: 'படித்தது', நாம்: 'படித்தோம்', நீங்கள்: 'படித்தீர்கள்', அவர்கள்: 'படித்தார்கள்' }, future: { நான்: 'படிப்பேன்', நீ: 'படிப்பாய்', அவன்: 'படிப்பான்', அவள்: 'படிப்பாள்', அது: 'படிக்கும்', நாம்: 'படிப்போம்', நீங்கள்: 'படிப்பீர்கள்', அவர்கள்: 'படிப்பார்கள்' } }
  };
  const PRONOUNS_DATA = { 'நான்': 'I', 'நீ': 'You (inf)', 'அவன்': 'He (inf)', 'அவள்': 'She (inf)', 'அது': 'It', 'நாம்': 'We', 'நீங்கள்': 'You (pol)', 'அவர்கள்': 'They' };
  const QUIZ_SETTINGS = {
    MULTIPLE_CHOICE_OPTIONS: 4,
    MULTIPLE_CHOICE_QUESTIONS_LIMIT: 10,
    MATCHING_GAME_PAIRS: 5,
    SENTENCE_BUILDER_SENTENCES: 5,
    SENTENCE_BUILDER_DISTRACTORS: 4,
  };

  // From utils/helpers.ts
  function shuffleArray(array) {
    const newArr = [...array];
    for (let i = newArr.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [newArr[i], newArr[j]] = [newArr[j], newArr[i]];
    }
    return newArr;
  }

  // From hooks/useLocalStorage.ts
  function useLocalStorage(key, initialValue) {
    const [storedValue, setStoredValue] = useState(() => {
      if (typeof window === 'undefined') return initialValue;
      try {
        const item = window.localStorage.getItem(key);
        return item ? JSON.parse(item) : initialValue;
      } catch (error) { console.error(error); return initialValue; }
    });
    const setValue = (value) => {
      try {
        const valueToStore = value instanceof Function ? value(storedValue) : value;
        setStoredValue(valueToStore);
        if (typeof window !== 'undefined') window.localStorage.setItem(key, JSON.stringify(valueToStore));
      } catch (error) { console.error(error); }
    };
    return [storedValue, setValue];
  }

  // --- Components ---
  const HeaderComponent = () => React.createElement("header", { className: "text-center mb-6" },
          React.createElement("h1", { className: "text-3xl md:text-4xl font-extrabold text-indigo-600 dark:text-indigo-400 tamil-font" }, "தமிழ் பயிற்சி"),
          React.createElement("p", { className: "text-slate-600 dark:text-slate-300 mt-1" }, "Tamil Language Practice")
  );

  const BackButtonComponent = ({ onClick, text = "Back" }) => React.createElement("div", { className: "text-center mt-8" },
          React.createElement("button", { onClick, className: "px-6 py-2 bg-gray-200 hover:bg-gray-300 dark:bg-slate-600 dark:hover:bg-slate-500 text-slate-700 dark:text-slate-100 font-semibold rounded-lg shadow-sm transition-colors" }, text)
  );

  const ProgressBarComponent = ({ progress }) => React.createElement("div", { className: "mb-4" },
          React.createElement("div", { className: "bg-slate-200 dark:bg-slate-700 rounded-full h-3" },
                  React.createElement("div", { className: "progress-bar-inner bg-amber-500 dark:bg-amber-400 h-3 rounded-full", style: { width: `${Math.max(0, Math.min(100, progress))}%` }, "aria-valuenow": progress, "aria-valuemin": 0, "aria-valuemax": 100, role: "progressbar", "aria-label": "Quiz progress" })
          )
  );

  const FeedbackModalComponent = ({ feedbackInfo, onContinue }) => {
    if (!feedbackInfo) return null;
    const { isCorrect, title, message } = feedbackInfo;
    const modalBgColor = isCorrect ? 'bg-emerald-500' : 'bg-rose-500';
    const buttonTextColor = isCorrect ? 'text-emerald-600' : 'text-rose-600';
    return React.createElement("div", { className: "fixed inset-0 bg-black bg-opacity-50 flex items-end justify-center p-4 transition-opacity duration-300 ease-in-out" },
            React.createElement("div", { className: `w-full max-w-2xl rounded-t-2xl p-6 text-center text-white ${modalBgColor}` },
                    React.createElement("h2", { className: "text-2xl font-bold" }, title),
                    React.createElement("p", { className: "mt-2 text-lg" }, message),
                    React.createElement("button", { onClick: onContinue, className: `mt-4 px-8 py-3 bg-white ${buttonTextColor} font-bold rounded-lg shadow-md transition-all` }, "Continue")
            )
    );
  };

  const LessonListComponent_getWordsForLesson = (lessonKey) => {
    if (!lessonKey || lessonKey === 'alphabet' || lessonKey === 'conjugation') return [];
    const lessonNum = parseInt(lessonKey);
    return VOCABULARY_DATA.filter(w => w.lesson === lessonNum);
  };
  const LessonListComponent = ({ onSelectLesson, masteredWords }) => React.createElement("div", null,
          React.createElement("h2", { className: "text-2xl font-bold text-slate-800 dark:text-slate-100 text-center mb-6" }, "Lessons"),
          React.createElement("div", { className: "space-y-3" },
                  Object.keys(LESSONS_DATA).map(key => {
                    const lesson = LESSONS_DATA[key];
                    const lessonWords = LessonListComponent_getWordsForLesson(key);
                    const masteredCount = lessonWords.filter(w => masteredWords.includes(w.id)).length;
                    const progress = lessonWords.length > 0 ? Math.round((masteredCount / lessonWords.length) * 100) : 0;
                    const progressDisplay = (key !== 'alphabet' && key !== 'conjugation') ?
                            React.createElement(Fragment, null,
                                    React.createElement("div", { className: "bg-slate-200 dark:bg-slate-600 rounded-full h-2.5 w-full" }, React.createElement("div", { className: "bg-amber-500 dark:bg-amber-400 h-2.5 rounded-full", style: { width: `${progress}%` } })),
                                    React.createElement("span", { className: "text-xs font-semibold text-slate-600 dark:text-slate-300" }, `${progress}%`)
                            ) : React.createElement("span", { className: "text-emerald-600 dark:text-emerald-400 font-semibold" }, "Reference");
                    return React.createElement("button", { key, onClick: () => onSelectLesson(key), className: "w-full text-left p-4 bg-white dark:bg-slate-700 hover:bg-gray-50 dark:hover:bg-slate-600 rounded-lg shadow-md transition-all flex items-center gap-4 border border-slate-200 dark:border-slate-600", "aria-label": `Select lesson: ${lesson.title}`},
                            React.createElement("div", { className: "flex-grow" },
                                    React.createElement("span", { className: "font-bold text-lg text-slate-700 dark:text-slate-100" }, lesson.title),
                                    React.createElement("p", { className: "text-sm text-slate-500 dark:text-slate-400" }, lesson.description)
                            ), React.createElement("div", { className: "w-24 text-right flex flex-col items-end gap-1" }, progressDisplay)
                    );
                  })
          )
  );

  const LessonMenuComponent = ({ currentLessonKey, navigateTo }) => {
    const lesson = LESSONS_DATA[currentLessonKey];
    if (!lesson) return React.createElement("p", null, "Lesson not found.");
    return React.createElement("div", null,
            React.createElement("div", { className: "text-center mb-6" },
                    React.createElement("h2", { className: "text-2xl font-bold text-slate-800 dark:text-slate-100" }, lesson.title),
                    React.createElement("p", { className: "text-slate-500 dark:text-slate-400" }, lesson.description)
            ),
            React.createElement("div", { className: "grid grid-cols-1 md:grid-cols-2 gap-4" },
                    React.createElement("button", { onClick: () => navigateTo(View.VocabularyView), className: "w-full text-left p-4 bg-amber-500 hover:bg-amber-600 text-white rounded-lg shadow-md transition-all", "aria-label": "Learn Vocabulary for this lesson" },
                            React.createElement("span", { className: "font-bold text-lg" }, "Learn Vocabulary"),
                            React.createElement("p", { className: "text-sm opacity-90" }, "Review words for this lesson.")
                    ),
                    React.createElement("button", { onClick: () => navigateTo(View.GrammarView), className: `w-full text-left p-4 bg-emerald-500 hover:bg-emerald-600 text-white rounded-lg shadow-md transition-all ${!lesson.hasGrammar ? 'opacity-50 cursor-not-allowed' : ''}`, disabled: !lesson.hasGrammar, "aria-label": "View Grammar Notes for this lesson" },
                            React.createElement("span", { className: "font-bold text-lg" }, "Grammar Notes"),
                            React.createElement("p", { className: "text-sm opacity-90" }, "Key concepts for this lesson.")
                    ),
                    React.createElement("button", { onClick: () => navigateTo(View.ActivityMenu), className: "md:col-span-2 w-full text-left p-4 bg-indigo-500 hover:bg-indigo-600 text-white rounded-lg shadow-md transition-all", "aria-label": "Practice Drills for this lesson" },
                            React.createElement("span", { className: "font-bold text-lg" }, "Practice Drills"),
                            React.createElement("p", { className: "text-sm opacity-90" }, "Test your knowledge.")
                    )
            ),
            React.createElement(BackButtonComponent, { onClick: () => navigateTo(View.LessonList, { currentLessonKey: null }), text: "Back to Lessons" })
    );
  };

  const AlphabetSection = ({ title, letters }) => React.createElement(Fragment, null,
          React.createElement("h3", { className: "text-xl font-bold text-slate-700 dark:text-slate-200 mt-6 mb-2" }, title),
          React.createElement("div", { className: "grid grid-cols-3 sm:grid-cols-4 md:grid-cols-6 gap-2 text-center" },
                  letters.map(l => React.createElement("div", { key: l.trans, className: "p-3 bg-gray-100 dark:bg-slate-700 rounded-lg shadow-sm" },
                          React.createElement("p", { className: "tamil-font text-2xl text-slate-800 dark:text-slate-100" }, l.tamil),
                          React.createElement("p", { className: "text-xs text-slate-500 dark:text-slate-400" }, l.trans)
                  ))
          )
  );
  const AlphabetViewComponent = ({ navigateTo }) => React.createElement("div", null,
          React.createElement("h2", { className: "text-2xl font-bold text-slate-800 dark:text-slate-100 text-center mb-4" }, "The Tamil Alphabet"),
          React.createElement(AlphabetSection, { title: "Vowels (உயிரெழுத்துக்கள்)", letters: ALPHABET_DATA.vowels }),
          React.createElement(AlphabetSection, { title: "Consonants (மெய்யெழுத்துக்கள்)", letters: ALPHABET_DATA.consonants }),
          React.createElement(AlphabetSection, { title: "Grantha Letters (கிரந்த எழுத்துக்கள்)", letters: ALPHABET_DATA.grantha }),
          React.createElement(BackButtonComponent, { onClick: () => navigateTo(View.LessonList), text: "Back to Lessons" })
  );

  const GrammarViewComponent = ({ currentLessonKey, navigateTo }) => {
    const lessonNum = parseInt(currentLessonKey);
    const notes = GRAMMAR_NOTES_DATA[lessonNum];
    if (!notes) return React.createElement("div", null, React.createElement("p", { className: "text-center text-slate-600 dark:text-slate-300" }, "No grammar notes available for this lesson."), React.createElement(BackButtonComponent, { onClick: () => navigateTo(View.LessonMenu), text: "Back to Lesson Menu" }));
    return React.createElement("div", null,
            React.createElement("h2", { className: "text-2xl font-bold text-slate-800 dark:text-slate-100 text-center mb-4" }, notes.title),
            React.createElement("ul", { className: "space-y-3" }, notes.points.map((point, index) => React.createElement("li", { key: index, className: "p-3 bg-gray-100 dark:bg-slate-700 rounded-lg shadow-sm text-slate-700 dark:text-slate-300" }, point))),
            React.createElement(BackButtonComponent, { onClick: () => navigateTo(View.LessonMenu), text: "Back to Lesson Menu" })
    );
  };

  const VocabularyViewComponent = ({ currentLessonKey, navigateTo }) => {
    const lessonNum = parseInt(currentLessonKey);
    const words = VOCABULARY_DATA.filter(w => w.lesson === lessonNum);
    if (words.length === 0) return React.createElement("div", null, React.createElement("p", { className: "text-center text-slate-600 dark:text-slate-300" }, "No vocabulary available for this lesson."), React.createElement(BackButtonComponent, { onClick: () => navigateTo(View.LessonMenu), text: "Back to Lesson Menu" }));
    return React.createElement("div", null,
            React.createElement("h2", { className: "text-2xl font-bold text-slate-800 dark:text-slate-100 text-center mb-4" }, `Lesson ${currentLessonKey} Vocabulary`),
            React.createElement("div", { className: "space-y-2" }, words.map(word => React.createElement("div", { key: word.id, className: "flex justify-between items-center p-3 bg-gray-100 dark:bg-slate-700 rounded-lg shadow-sm" },
                    React.createElement("p", { className: "tamil-font text-xl font-semibold text-indigo-600 dark:text-indigo-400" }, word.tamil_word),
                    React.createElement("p", { className: "text-lg text-slate-700 dark:text-slate-200" }, word.english_meaning)
            ))),
            React.createElement(BackButtonComponent, { onClick: () => navigateTo(View.LessonMenu), text: "Back to Lesson Menu" })
    );
  };

  const ActivityMenuComponent = ({ currentLessonKey, navigateTo, startQuiz }) => {
    const lesson = LESSONS_DATA[currentLessonKey];
    if (!lesson) return React.createElement("p", null, "Lesson not found.");
    return React.createElement("div", null,
            React.createElement("div", { className: "text-center mb-6" }, React.createElement("h2", { className: "text-2xl font-bold text-slate-800 dark:text-slate-100" }, `Practice: ${lesson.title}`)),
            React.createElement("div", { className: "grid grid-cols-1 gap-4" },
                    React.createElement("button", { onClick: () => startQuiz('multipleChoice'), className: "w-full text-left p-4 bg-indigo-500 hover:bg-indigo-600 text-white rounded-lg shadow-md transition-colors", "aria-label": "Start Multiple Choice Quiz" }, "Multiple Choice"),
                    React.createElement("button", { onClick: () => startQuiz('matching'), className: "w-full text-left p-4 bg-amber-500 hover:bg-amber-600 text-white rounded-lg shadow-md transition-colors", "aria-label": "Start Matching Game" }, "Matching Game"),
                    React.createElement("button", { onClick: () => startQuiz('sentenceBuilding', 'EtoT'), className: "w-full text-left p-4 bg-emerald-500 hover:bg-emerald-600 text-white rounded-lg shadow-md transition-colors", "aria-label": "Start Sentence Builder (English to Tamil)" }, "Sentence Builder (EN → TA)"),
                    React.createElement("button", { onClick: () => startQuiz('sentenceBuilding', 'TtoE'), className: "w-full text-left p-4 bg-green-500 hover:bg-green-600 text-white rounded-lg shadow-md transition-colors", "aria-label": "Start Sentence Builder (Tamil to English)" }, "Sentence Builder (TA → EN)")
            ),
            React.createElement(BackButtonComponent, { onClick: () => navigateTo(View.LessonMenu), text: "Back to Lesson Menu" })
    );
  };

  const ResultsComponent = ({ quizState, currentLessonKey, navigateTo }) => {
    const quizSize = quizState.questions.length;
    return React.createElement("div", { className: "text-center" },
            React.createElement("h2", { className: "text-4xl font-extrabold text-slate-800 dark:text-slate-100 mb-2" }, "Drill Complete!"),
            React.createElement("p", { className: "text-xl text-slate-600 dark:text-slate-300 mb-6" }, "You scored:"),
            React.createElement("p", { className: "text-6xl font-bold text-amber-500 dark:text-amber-400 mb-8" }, `${quizState.score} / ${quizSize}`),
            React.createElement("button", { onClick: () => navigateTo(View.LessonMenu, { currentLessonKey: currentLessonKey }), className: "w-full max-w-xs px-6 py-4 bg-indigo-500 hover:bg-indigo-600 text-white font-bold rounded-lg shadow-md transition-colors" }, "Back to Lesson Menu")
    );
  };

  const ConjugationMenuComponent = ({ navigateTo }) => React.createElement("div", null,
          React.createElement("div", { className: "text-center mb-6" },
                  React.createElement("h2", { className: "text-2xl font-bold text-slate-800 dark:text-slate-100" }, "Verb Conjugation"),
                  React.createElement("p", { className: "text-slate-500 dark:text-slate-400" }, "Select a verb to see its forms.")
          ),
          React.createElement("div", { className: "grid grid-cols-1 md:grid-cols-2 gap-3" },
                  Object.keys(CONJUGATIONS_DATA).map(verb => React.createElement("button", { key: verb, onClick: () => navigateTo(View.ConjugationPractice, { currentVerbId: verb }), className: "w-full p-4 bg-gray-100 dark:bg-slate-700 hover:bg-gray-200 dark:hover:bg-slate-600 rounded-lg text-lg font-semibold flex justify-between items-center transition-colors shadow-sm border border-slate-200 dark:border-slate-600", "aria-label": `Select verb: ${verb}` },
                          React.createElement("span", { className: "tamil-font text-indigo-600 dark:text-indigo-400" }, verb),
                          React.createElement("span", { className: "text-sm text-slate-500 dark:text-slate-400" }, CONJUGATIONS_DATA[verb].english)
                  ))
          ),
          React.createElement(BackButtonComponent, { onClick: () => navigateTo(View.LessonList), text: "Back to Lessons" })
  );

  const ConjugationPracticeComponent = ({ currentVerbId, navigateTo }) => {
    const [tense, setTense] = useState('present');
    const verbData = CONJUGATIONS_DATA[currentVerbId];
    if (!verbData) return React.createElement("p", null, "Verb not found.");
    return React.createElement("div", null,
            React.createElement("div", { className: "text-center mb-6" },
                    React.createElement("h2", { className: "text-3xl font-bold tamil-font text-indigo-700 dark:text-indigo-400" }, currentVerbId),
                    React.createElement("p", { className: "text-slate-500 dark:text-slate-400" }, verbData.english)
            ),
            React.createElement("div", { className: "flex justify-center gap-2 mb-6" },
                    ['present', 'past', 'future'].map(t => React.createElement("button", { key: t, onClick: () => setTense(t), className: `px-4 py-2 rounded-md font-semibold transition-colors ${tense === t ? 'bg-amber-500 text-white shadow-md' : 'bg-gray-200 dark:bg-slate-600 hover:bg-gray-300 dark:hover:bg-slate-500 text-slate-700 dark:text-slate-100'}`, "aria-pressed": tense === t }, t.charAt(0).toUpperCase() + t.slice(1)))
            ),
            React.createElement("div", { className: "overflow-x-auto bg-white dark:bg-slate-700 rounded-lg shadow-md" },
                    React.createElement("table", { className: "w-full text-left border-collapse conjugation-table" },
                            React.createElement("thead", null, React.createElement("tr", { className: "bg-gray-100 dark:bg-slate-600" },
                                    React.createElement("th", { className: "p-3 font-semibold text-slate-700 dark:text-slate-200 border-b border-slate-200 dark:border-slate-500" }, "Pronoun (T)"),
                                    React.createElement("th", { className: "p-3 font-semibold text-slate-700 dark:text-slate-200 border-b border-slate-200 dark:border-slate-500" }, "Pronoun (E)"),
                                    React.createElement("th", { className: "p-3 font-semibold text-slate-700 dark:text-slate-200 border-b border-slate-200 dark:border-slate-500" }, "Conjugated Verb")
                            )),
                            React.createElement("tbody", null, Object.keys(PRONOUNS_DATA).map(pronoun => React.createElement("tr", { key: pronoun, className: "dark:bg-slate-700 even:bg-gray-50 dark:even:bg-slate-700/60 hover:bg-gray-100 dark:hover:bg-slate-600/50 transition-colors" },
                                    React.createElement("td", { className: "p-3 tamil-font text-slate-700 dark:text-slate-200 border-b border-slate-200 dark:border-slate-500" }, pronoun),
                                    React.createElement("td", { className: "p-3 text-slate-600 dark:text-slate-300 border-b border-slate-200 dark:border-slate-500" }, PRONOUNS_DATA[pronoun]),
                                    React.createElement("td", { className: "p-3 tamil-font font-bold text-amber-600 dark:text-amber-400 border-b border-slate-200 dark:border-slate-500" }, verbData[tense]?.[pronoun] || '-')
                            )))
                    )
            ),
            React.createElement(BackButtonComponent, { onClick: () => navigateTo(View.ConjugationMenu, { currentVerbId: null }), text: "Back to Verbs" })
    );
  };

  const MultipleChoiceQuizComponent = ({ quizState, currentLessonKey, onSubmitAnswer, navigateTo }) => {
    const { questions, currentQuestionIndex } = quizState;
    const question = questions[currentQuestionIndex];
    if (!question) return React.createElement("p", null, "Error: Question not found.");
    const wordsInScope = VOCABULARY_DATA.filter(w => { const lessonNum = parseInt(currentLessonKey); return w.lesson <= lessonNum; });
    const otherOptions = shuffleArray(wordsInScope.filter(w => w.id !== question.id)).slice(0, QUIZ_SETTINGS.MULTIPLE_CHOICE_OPTIONS - 1);
    const options = shuffleArray([question, ...otherOptions]);
    const progress = questions.length > 0 ? Math.round(((currentQuestionIndex) / questions.length) * 100) : 0;
    return React.createElement("div", null,
            React.createElement(ProgressBarComponent, { progress }),
            React.createElement("p", { className: "text-slate-500 dark:text-slate-400 mb-2" }, "What is the meaning of:"),
            React.createElement("h2", { className: "tamil-font text-5xl font-bold text-center mb-8 text-indigo-600 dark:text-indigo-400" }, question.tamil_word),
            React.createElement("div", { className: "grid grid-cols-1 md:grid-cols-2 gap-3" },
                    options.map(opt => React.createElement("button", { key: opt.id, onClick: () => onSubmitAnswer(opt.id === question.id, question.id), className: "w-full p-4 bg-gray-100 dark:bg-slate-700 hover:bg-gray-200 dark:hover:bg-slate-600 rounded-lg text-lg font-semibold text-slate-700 dark:text-slate-100 transition-colors shadow-sm border border-slate-200 dark:border-slate-600", "aria-label": opt.english_meaning }, opt.english_meaning))
            ),
            React.createElement(BackButtonComponent, { onClick: () => navigateTo(View.ActivityMenu), text: "Back to Activities" })
    );
  };

  const MatchingGameComponent = ({ quizState, onSelectItem, navigateTo, tamilWords, englishWords }) => {
    const { selectedTamilId, selectedEnglishId, correctPairs = 0, matchingGameWords, questions } = quizState;
    const totalPairs = matchingGameWords?.length || questions.length || 0;
    const progress = totalPairs > 0 ? Math.round(((correctPairs || 0) / totalPairs) * 100) : 0;
    const getItemClasses = (id, type) => {
      const isSelected = type === 'tamil' ? selectedTamilId === id : selectedEnglishId === id;
      let baseClasses = "w-full p-4 rounded-lg text-lg font-semibold transition-all shadow-sm border border-slate-200 dark:border-slate-600";
      if (isSelected) return `${baseClasses} ring-2 ring-amber-500 dark:ring-amber-400 bg-amber-100 dark:bg-amber-700/50 text-slate-800 dark:text-slate-100`;
      return `${baseClasses} bg-gray-100 dark:bg-slate-700 hover:bg-gray-200 dark:hover:bg-slate-600 text-slate-700 dark:text-slate-100`;
    };
    return React.createElement("div", null,
            React.createElement(ProgressBarComponent, { progress }),
            React.createElement("h2", { className: "text-2xl font-bold text-slate-800 dark:text-slate-100 text-center mb-4" }, "Matching Game"),
            React.createElement("p", { className: "text-center text-slate-500 dark:text-slate-400 mb-6" }, `Match the Tamil word to its English meaning. (${correctPairs}/${totalPairs} matched)`),
            React.createElement("div", { className: "grid grid-cols-2 gap-4" },
                    React.createElement("div", { id: "tamil-col", className: "flex flex-col gap-3" },
                            tamilWords.map(word => React.createElement("button", { key: `tamil-${word.id}`, id: `tamil-${word.id}`, onClick: () => onSelectItem('tamil', word.id), className: `${getItemClasses(word.id, 'tamil')} tamil-font`, "aria-pressed": selectedTamilId === word.id }, word.tamil_word))
                    ),
                    React.createElement("div", { id: "english-col", className: "flex flex-col gap-3" },
                            englishWords.map(word => React.createElement("button", { key: `english-${word.id}`, id: `english-${word.id}`, onClick: () => onSelectItem('english', word.id), className: getItemClasses(word.id, 'english'), "aria-pressed": selectedEnglishId === word.id }, word.english_meaning))
                    )
            ),
            React.createElement(BackButtonComponent, { onClick: () => navigateTo(View.ActivityMenu), text: "Back to Activities" })
    );
  };

  const SentenceBuilderComponent = ({ quizState, onWordBankClick, onAnswerTileClick, onSubmitSentence, navigateTo }) => {
    const { questions, currentQuestionIndex, sentenceDirection, sentenceBuilderConstructed, sentenceBuilderWordBank } = quizState;
    const question = questions[currentQuestionIndex];
    if (!question) return React.createElement("p", null, "Error: Question not found.");
    const isTtoE = sentenceDirection === 'TtoE';
    const prompt = isTtoE ? question.tamil : question.english;
    const promptLangClass = isTtoE ? 'tamil-font text-2xl md:text-3xl' : 'text-xl md:text-2xl';
    const answerAreaClass = isTtoE ? 'text-lg' : 'tamil-font text-xl';
    const wordBankClass = isTtoE ? 'text-base' : 'tamil-font text-lg';
    const progress = questions.length > 0 ? Math.round(((currentQuestionIndex) / questions.length) * 100) : 0;
    return React.createElement("div", null,
            React.createElement(ProgressBarComponent, { progress }),
            React.createElement("p", { className: "text-slate-500 dark:text-slate-400 mb-2 text-center" }, "Translate this sentence:"),
            React.createElement("h2", { className: `${promptLangClass} font-semibold text-center mb-4 p-3 bg-gray-100 dark:bg-slate-700 rounded-lg min-h-[3.5em] flex items-center justify-center text-slate-800 dark:text-slate-100 shadow-sm` }, prompt),
            React.createElement("div", { id: "answer-area", "aria-label": "Constructed sentence area", className: "min-h-[70px] border-2 border-dashed border-amber-400 dark:border-amber-500 mb-4 flex flex-wrap gap-2 p-3 items-center rounded-lg bg-amber-50 dark:bg-amber-800/20" },
                    sentenceBuilderConstructed?.map((word, index) => React.createElement("button", { key: `${word}-${index}`, onClick: () => onAnswerTileClick(word, index), "aria-label": `Remove word: ${word}`, className: `answer-tile ${answerAreaClass} p-2 px-3 rounded-lg bg-amber-200 dark:bg-amber-600 text-amber-800 dark:text-amber-100 font-semibold shadow-sm cursor-pointer hover:bg-amber-300 dark:hover:bg-amber-500 transition-colors` }, word)),
                    (!sentenceBuilderConstructed || sentenceBuilderConstructed.length === 0) && React.createElement("span", { className: "text-slate-400 dark:text-slate-500 italic px-2" }, "Click words below to build the sentence")
            ),
            React.createElement("div", { id: "word-bank", "aria-label": "Word bank", className: "flex flex-wrap justify-center gap-2 p-3 min-h-[70px] bg-gray-100 dark:bg-slate-700/50 rounded-lg shadow-inner" },
                    sentenceBuilderWordBank?.map((word, index) => React.createElement("button", { key: `${word}-${index}-bank`, onClick: () => onWordBankClick(word), "aria-label": `Add word: ${word}`, className: `word-bank-tile ${wordBankClass} p-2 px-3 rounded-lg bg-gray-200 dark:bg-slate-600 hover:bg-gray-300 dark:hover:bg-slate-500 text-slate-700 dark:text-slate-100 font-semibold shadow cursor-pointer transition-colors` }, word))
            ),
            React.createElement("div", { className: "text-center mt-6" }, React.createElement("button", { id: "check-sentence-btn", onClick: onSubmitSentence, className: "px-8 py-3 bg-emerald-500 hover:bg-emerald-600 text-white font-bold rounded-lg shadow-md disabled:opacity-50 transition-colors", disabled: !sentenceBuilderConstructed || sentenceBuilderConstructed.length === 0, "aria-label": "Check sentence" }, "Check")),
            React.createElement(BackButtonComponent, { onClick: () => navigateTo(View.ActivityMenu), text: "Back to Activities" })
    );
  };

  // --- Main App Component ---
  // (App.tsx logic, using the functions and components defined above)
  const App = () => {
    const [currentView, setCurrentView] = useState(View.LessonList);
    const [currentLessonKey, setCurrentLessonKey] = useState(null);
    const [currentVerbId, setCurrentVerbId] = useState(null);
    const [quizState, setQuizState] = useState(null);
    const [feedbackInfo, setFeedbackInfo] = useState(null);
    const [masteredWords, setMasteredWords] = useLocalStorage('tamilAppProgress_v2', []); // Changed key for fresh start
    const [shuffledTamilWords, setShuffledTamilWords] = useState([]);
    const [shuffledEnglishWords, setShuffledEnglishWords] = useState([]);

    const updateMastery = useCallback((wordId) => {
      setMasteredWords(prev => prev.includes(wordId) ? prev : [...prev, wordId]);
    }, [setMasteredWords]);

    const navigateTo = useCallback((view, payload) => {
      setCurrentView(view);
      if (payload?.currentLessonKey !== undefined) setCurrentLessonKey(payload.currentLessonKey);
      if (payload?.currentVerbId !== undefined) setCurrentVerbId(payload.currentVerbId);
      if (view === View.LessonList) { setCurrentLessonKey(null); setCurrentVerbId(null); setQuizState(null); }
      else if (view === View.LessonMenu && payload?.currentLessonKey) { setCurrentLessonKey(payload.currentLessonKey); setQuizState(null); }
    }, []);

    const handleLessonSelect = useCallback((lessonKey) => {
      if (lessonKey === 'alphabet') navigateTo(View.AlphabetView, { currentLessonKey: lessonKey });
      else if (lessonKey === 'conjugation') navigateTo(View.ConjugationMenu, { currentLessonKey: lessonKey });
      else navigateTo(View.LessonMenu, { currentLessonKey: lessonKey });
    }, [navigateTo]);

    // getWordsForLesson and getSentencesForLesson remain largely the same, using the global VOCABULARY_DATA and SENTENCES_DATA
    const getWordsForLesson = useCallback((lessonKey, cumulative = true) => {
      if (!lessonKey || lessonKey === 'alphabet' || lessonKey === 'conjugation') return [];
      const lessonNum = parseInt(lessonKey);
      let words = [];
      if (cumulative) { // For quizzes, usually take from current and previous lessons
        const targetLessons = Object.keys(LESSONS_DATA)
                .map(k => parseInt(k))
                .filter(k => !isNaN(k) && k <= lessonNum);
        targetLessons.forEach(ln => words.push(...VOCABULARY_DATA.filter(w => w.lesson === ln)));
      } else { // For vocabulary view, only current lesson
        words = VOCABULARY_DATA.filter(w => w.lesson === lessonNum);
      }
      return words;
    }, []);

    const getSentencesForLesson = useCallback((lessonKey) => {
      if (!lessonKey) return [];
      const lessonNum = parseInt(lessonKey);
      // For sentences, usually take from current and previous lessons for cumulative practice
      const targetLessons = Object.keys(LESSONS_DATA)
              .map(k => parseInt(k))
              .filter(k => !isNaN(k) && k <= lessonNum);
      let sentences = [];
      targetLessons.forEach(ln => sentences.push(...SENTENCES_DATA.filter(s => s.lesson === ln)));
      return sentences;
    }, []);


    const startQuiz = useCallback((quizType, direction) => {
      if (!currentLessonKey) return;
      let questions = [];
      const initialQuizState = { type: quizType, currentQuestionIndex: 0, score: 0 };

      if (quizType === 'multipleChoice') {
        questions = shuffleArray(getWordsForLesson(currentLessonKey, true));
        if (questions.length > QUIZ_SETTINGS.MULTIPLE_CHOICE_QUESTIONS_LIMIT) questions = questions.slice(0, QUIZ_SETTINGS.MULTIPLE_CHOICE_QUESTIONS_LIMIT);
      } else if (quizType === 'matching') {
        const gameWords = shuffleArray(getWordsForLesson(currentLessonKey, true)).slice(0, QUIZ_SETTINGS.MATCHING_GAME_PAIRS);
        questions = gameWords;
        initialQuizState.matchingGameWords = gameWords;
        initialQuizState.selectedTamilId = null; initialQuizState.selectedEnglishId = null; initialQuizState.correctPairs = 0;
        setShuffledTamilWords(shuffleArray([...gameWords])); setShuffledEnglishWords(shuffleArray([...gameWords]));
      } else if (quizType === 'sentenceBuilding') {
        questions = shuffleArray(getSentencesForLesson(currentLessonKey)).slice(0, QUIZ_SETTINGS.SENTENCE_BUILDER_SENTENCES);
        initialQuizState.sentenceDirection = direction;
        if (questions.length > 0) {
          const firstSentence = questions[0];
          const words = (direction === 'TtoE' ? firstSentence.english : firstSentence.tamil).split(' ');
          const distractorPool = direction === 'TtoE' ? VOCABULARY_DATA.map(v => v.english_meaning.split(' ')).flat() : VOCABULARY_DATA.map(v => v.tamil_word);
          const distractors = shuffleArray([...new Set(distractorPool)]).filter(w => !words.includes(w)).slice(0, QUIZ_SETTINGS.SENTENCE_BUILDER_DISTRACTORS);
          initialQuizState.sentenceBuilderWordBank = shuffleArray([...words, ...distractors]);
          initialQuizState.sentenceBuilderConstructed = [];
        } else { setFeedbackInfo({ isCorrect: false, title: "No Sentences", message: "No sentences available for this lesson." }); return; }
      }
      if (questions.length === 0 && quizType !== 'sentenceBuilding') { setFeedbackInfo({ isCorrect: false, title: "No Content", message: "No questions available." }); return; }

      const viewTarget = quizType === 'multipleChoice' ? View.MultipleChoice : quizType === 'matching' ? View.Matching : View.SentenceBuilding;
      setQuizState({ ...initialQuizState, questions });
      navigateTo(viewTarget);
    }, [currentLessonKey, getWordsForLesson, getSentencesForLesson, navigateTo]);

    const handleQuizAnswer = useCallback((isCorrect, wordId) => {
      if (!quizState) return;
      let message = "";
      const currentQuestion = quizState.questions[quizState.currentQuestionIndex];
      if (quizState.type === 'multipleChoice' && currentQuestion) {
        const q = currentQuestion;
        message = isCorrect ? `“${q.tamil_word}” means “${q.english_meaning}”.` : `Correct: “${q.tamil_word}” means “${q.english_meaning}”.`;
        if (isCorrect && wordId) updateMastery(wordId);
      } else if (quizState.type === 'sentenceBuilding' && currentQuestion) {
        const q = currentQuestion;
        const correctTranslation = quizState.sentenceDirection === 'EtoT' ? q.tamil : q.english;
        message = isCorrect ? `Correct! Full sentence: ${correctTranslation}` : `Incorrect. Correct: ${correctTranslation}`;
      }
      setFeedbackInfo({ isCorrect, title: isCorrect ? 'Correct!' : 'Incorrect', message });
      if (isCorrect) setQuizState(prev => prev ? ({ ...prev, score: prev.score + 1 }) : null);
    }, [quizState, updateMastery]);

    const handleMatchingSelectItem = useCallback((type, id) => {
      setQuizState(prev => {
        if (!prev || prev.type !== 'matching' || !prev.matchingGameWords) return prev;
        let { selectedTamilId, selectedEnglishId, correctPairs = 0 } = prev;
        const gameWords = prev.matchingGameWords; let localFeedback = null;
        if (type === 'tamil') selectedTamilId = selectedTamilId === id ? null : id;
        else selectedEnglishId = selectedEnglishId === id ? null : id;
        if (selectedTamilId !== null && selectedEnglishId !== null) {
          if (selectedTamilId === selectedEnglishId) {
            correctPairs++; updateMastery(selectedTamilId);
            const matchedWord = gameWords.find(w => w.id === selectedTamilId);
            localFeedback = { isCorrect: true, title: "Matched!", message: `“${matchedWord?.tamil_word}” - “${matchedWord?.english_meaning}”`};
            selectedTamilId = null; selectedEnglishId = null;
          } else { localFeedback = { isCorrect: false, title: "No Match", message: "Try again!"}; }
          setFeedbackInfo(localFeedback);
        }
        return { ...prev, selectedTamilId, selectedEnglishId, correctPairs };
      });
    }, [updateMastery]);

    const handleSentenceBuilderWordBankClick = useCallback((word) => {
      setQuizState(prev => {
        if (!prev || prev.type !== 'sentenceBuilding') return prev;
        const newConstructed = [...(prev.sentenceBuilderConstructed || []), word];
        let wordRemoved = false;
        const newWordBank = (prev.sentenceBuilderWordBank || []).filter(w => { if (!wordRemoved && w === word) { wordRemoved = true; return false; } return true; });
        return { ...prev, sentenceBuilderConstructed: newConstructed, sentenceBuilderWordBank: newWordBank };
      });
    }, []);
    const handleSentenceBuilderAnswerTileClick = useCallback((word, index) => {
      setQuizState(prev => {
        if (!prev || prev.type !== 'sentenceBuilding') return prev;
        const newConstructed = (prev.sentenceBuilderConstructed || []).filter((_, i) => i !== index);
        const newWordBank = shuffleArray([...(prev.sentenceBuilderWordBank || []), word]);
        return { ...prev, sentenceBuilderConstructed: newConstructed, sentenceBuilderWordBank: newWordBank };
      });
    }, []);
    const handleSentenceSubmit = useCallback(() => {
      if (!quizState || quizState.type !== 'sentenceBuilding' || !quizState.sentenceBuilderConstructed) return;
      const currentQuestion = quizState.questions[quizState.currentQuestionIndex];
      const constructed = quizState.sentenceBuilderConstructed.join(' ');
      const correctAnswer = quizState.sentenceDirection === 'TtoE' ? currentQuestion.english : currentQuestion.tamil;
      handleQuizAnswer(constructed === correctAnswer);
    }, [quizState, handleQuizAnswer]);

    const nextQuestion = useCallback(() => {
      setFeedbackInfo(null); if (!quizState) return;
      if (quizState.type === 'matching') {
        if (quizState.correctPairs === quizState.matchingGameWords?.length) navigateTo(View.Results);
        else { const fbi = feedbackInfo; if (fbi && !fbi.isCorrect) setQuizState(prev => prev ? {...prev, selectedTamilId: null, selectedEnglishId: null} : null); }
        return;
      }
      if (quizState.currentQuestionIndex < quizState.questions.length - 1) {
        const newIndex = quizState.currentQuestionIndex + 1;
        let updatedQuizState = { ...quizState, currentQuestionIndex: newIndex };
        if (quizState.type === 'sentenceBuilding') {
          const nextSentence = quizState.questions[newIndex];
          const words = (quizState.sentenceDirection === 'TtoE' ? nextSentence.english : nextSentence.tamil).split(' ');
          const distractorPool = quizState.sentenceDirection === 'TtoE' ? VOCABULARY_DATA.map(v => v.english_meaning.split(' ')).flat() : VOCABULARY_DATA.map(v => v.tamil_word);
          const distractors = shuffleArray([...new Set(distractorPool)]).filter(w => !words.includes(w)).slice(0, QUIZ_SETTINGS.SENTENCE_BUILDER_DISTRACTORS);
          updatedQuizState.sentenceBuilderWordBank = shuffleArray([...words, ...distractors]);
          updatedQuizState.sentenceBuilderConstructed = [];
        }
        setQuizState(updatedQuizState);
      } else { navigateTo(View.Results); }
    }, [quizState, navigateTo, feedbackInfo]);

    const renderView = () => {
      switch (currentView) {
        case View.LessonList: return React.createElement(LessonListComponent, { onSelectLesson: handleLessonSelect, masteredWords });
        case View.LessonMenu: return currentLessonKey ? React.createElement(LessonMenuComponent, { currentLessonKey, navigateTo }) : React.createElement(LessonListComponent, { onSelectLesson: handleLessonSelect, masteredWords });
        case View.AlphabetView: return React.createElement(AlphabetViewComponent, { navigateTo });
        case View.GrammarView: return currentLessonKey ? React.createElement(GrammarViewComponent, { currentLessonKey, navigateTo }) : (navigateTo(View.LessonList), null);
        case View.VocabularyView: return currentLessonKey ? React.createElement(VocabularyViewComponent, { currentLessonKey, navigateTo }) : (navigateTo(View.LessonList), null);
        case View.ActivityMenu: return currentLessonKey ? React.createElement(ActivityMenuComponent, { currentLessonKey, navigateTo, startQuiz }) : (navigateTo(View.LessonList), null);
        case View.MultipleChoice: return (quizState && currentLessonKey) ? React.createElement(MultipleChoiceQuizComponent, { quizState, currentLessonKey, onSubmitAnswer: handleQuizAnswer, navigateTo }) : (navigateTo(View.LessonList), null);
        case View.Matching: return (quizState && currentLessonKey && quizState.matchingGameWords) ? React.createElement(MatchingGameComponent, { quizState, onSelectItem: handleMatchingSelectItem, navigateTo, tamilWords: shuffledTamilWords, englishWords: shuffledEnglishWords }) : (navigateTo(View.LessonList), null);
        case View.SentenceBuilding: return (quizState && currentLessonKey) ? React.createElement(SentenceBuilderComponent, { quizState, onWordBankClick: handleSentenceBuilderWordBankClick, onAnswerTileClick: handleSentenceBuilderAnswerTileClick, onSubmitSentence: handleSentenceSubmit, navigateTo }) : (navigateTo(View.LessonList), null);
        case View.Results: return quizState ? React.createElement(ResultsComponent, { quizState, navigateTo, currentLessonKey }) : (navigateTo(View.LessonList), null);
        case View.ConjugationMenu: return React.createElement(ConjugationMenuComponent, { navigateTo });
        case View.ConjugationPractice: return currentVerbId ? React.createElement(ConjugationPracticeComponent, { currentVerbId, navigateTo }) : (navigateTo(View.ConjugationMenu), null);
        default: return React.createElement("p", null, "Unknown view");
      }
    };
    return React.createElement(Fragment, null,
            React.createElement(HeaderComponent, null),
            React.createElement("main", { className: "bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-xl min-h-[400px] border-t-4 border-amber-400 dark:border-amber-500" }, renderView()),
            feedbackInfo && React.createElement(FeedbackModalComponent, { feedbackInfo, onContinue: nextQuestion })
    );
  };

  // From index.tsx (React DOM render call)
  const rootElement = document.getElementById('root');
  if (!rootElement) throw new Error("Could not find root element to mount to");
  const root = ReactDOM.createRoot(rootElement);
  root.render(React.createElement(React.StrictMode, null, React.createElement(App, null)));

  // --- End of Inlined Code ---
</script>
</body>
</html>
